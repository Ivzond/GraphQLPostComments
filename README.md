Задача:

Реализовать систему для добавления и чтения постов и комментариев с использованием GraphQL, аналогичную комментариям к постам на популярных платформах, таких как Хабр или Reddit.

Характеристики системы постов:
• Можно просмотреть список постов.
• Можно просмотреть пост и комментарии под ним.
• Пользователь, написавший пост, может запретить оставление комментариев к своему посту.

Характеристики системы комментариев к постам:
• Комментарии организованы иерархически, позволяя вложенность без ограничений.
• Длина текста комментария ограничена до, например, 2000 символов.
• Система пагинации для получения списка комментариев.

(*) Дополнительные требования для реализации через GraphQL Subscriptions:
• Комментарии к постам должны доставляться асинхронно, т.е. клиенты, подписанные на определенный пост, должны получать уведомления о новых комментариях без необходимости повторного запроса.

Требования к реализации:
• Система должна быть написана на языке Go.
• Использование Docker для распространения сервиса в виде Docker-образа.
• Хранение данных может быть как в памяти (in-memory), так и в PostgreSQL. Выбор хранилища должен быть определяемым параметром при запуске сервиса.
• Покрытие реализованного функционала unit-тестами.


## Ход решения:

1) В первую очередь была создана схема .graphql для кодогенерации
2) Далее была написана основная бизнес-логика приложения, а именно круды для постов и комментариев, написаны их реализации для обоих форматов хранения данных(in-memory и в БД(Postgres в моем случае)).
3) Реализована система подписок, для этого в структуру резолвера добавлеа хэш-таблица с идентификаторами постов и подписками. Комментарии передаются через канал, который является значением для конкретной подписки. При запросе на подписку проверяется существует ли уже таблица подписчиков на пост, потом создается айди подписки и запускается горутина, которая удалит подписку, если контекст закроется  
4) Тут же был написан маленький конфигурационный файл для выбора места хранения перед запуском сервиса.
5) Также написаны Dockerfile и docker-compose(хорошо что остались недавние образы постгреса и го, из которых удалось собрать контейнер). Также в docker-compose подключил инициализацию схемы базы данных при запуске(для этого указал путь к файлу с запросом, также прописал скрипт, чтобы сам сервер перед запуском подождал секунду)
6) Были сделаны системы пагинации, для примера взял дефолтное значение в 10 комментариев на страницу, но этот параметр задаваемый. Были добавлены даталоадеры для кэширования и решения проблемы с n+1 запросами, так как при запросе поста и комментариев к нему может создаться много SQL-запросов. Для этого в даталоадере запускается цикл горутин, которые загружают комментарии в слайс
7) Наконец были написаны тесты, которые проверяют корректность работы резолверов и крудов внутри хранилища

# Как Запустить
Для запуска сервера нужно выбрать тип хранилища в конфигурационном файле в configs/config.yml.
Далее нужно будет собрать docker image с приложением, для этого из корневого диалога пишем:
```
docker build -t graphqlapp .
```
Далее запускаем сервис с помощью команды:
```
docker-compose up
```

Теперь приложение запущено и готово к использованию

**P.S.**

SQL-запрос создания таблиц, отношений и индексов можно посмотреть в файле инициализации(/init/init.sql)

Таблица users, как и сама сущность user добавлены для удобства разработки
